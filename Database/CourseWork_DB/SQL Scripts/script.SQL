-- DROP RELATIONSHIPS SECTION -------------------------------------------------

ALTER TABLE "ESTIMATE" DROP CONSTRAINT "CONTRACTOR_ESTIMATE"
/
ALTER TABLE "BUILDOBJECT" DROP CONSTRAINT "CLIENT_OBJECT"
/
ALTER TABLE "ESTIMATE" DROP CONSTRAINT "CUSTOMER_ESTIMATE"
/
ALTER TABLE "BUILDOBJECT" DROP CONSTRAINT "BUILDINGPURPOSE_OBJECT"
/
ALTER TABLE "ESTIMATE" DROP CONSTRAINT "ESTIMATETYPE_ESTIMATE"
/
ALTER TABLE "WORK" DROP CONSTRAINT "ESTIMATE_WORK"
/
ALTER TABLE "WORK" DROP CONSTRAINT "WORKSCATALOG_WORK"
/
ALTER TABLE "WORKSCATALOG" DROP CONSTRAINT "UNITS_WORKSCATALOG"
/
ALTER TABLE "MATERIAL" DROP CONSTRAINT "WORK_MATERIAL"
/
ALTER TABLE "ESTIMATE" DROP CONSTRAINT "OBJECT_ESTIMATE"
/
ALTER TABLE "ESTIMATE" DROP CONSTRAINT "ESTIMATESTATE_ESTIMATE"
/
ALTER TABLE "MATERIAL" DROP CONSTRAINT "MATERIALSCATALOG_MATERIAL"
/
ALTER TABLE "MATERIALSCATALOG" DROP CONSTRAINT "UNITS_MATERIALSCATALOG"
/





-- DROP KEYS FOR TABLES SECTION -------------------------------------------------

ALTER TABLE "CONTRACTOR" DROP CONSTRAINT "PK_CONTRACTOR"
/
ALTER TABLE "CONTRACTOR" DROP CONSTRAINT "CONTRACTORBN"
/
ALTER TABLE "CUSTOMER" DROP CONSTRAINT "PK_CUSTOMER"
/
ALTER TABLE "CUSTOMER" DROP CONSTRAINT "CUSTOMERBN"
/
ALTER TABLE "BUILDINGPURPOSE" DROP CONSTRAINT "PK_BUILDINGPURPOSE"
/
ALTER TABLE "BUILDINGPURPOSE" DROP CONSTRAINT "BPCODE"
/
ALTER TABLE "BUILDOBJECT" DROP CONSTRAINT "PK_OBJECT"
/
ALTER TABLE "ESTIMATETYPE" DROP CONSTRAINT "PK_ESTIMATETYPE"
/
ALTER TABLE "ESTIMATETYPE" DROP CONSTRAINT "ETCODE"
/
ALTER TABLE "ESTIMATESTATE" DROP CONSTRAINT "PK_ESTIMATESTATE"
/
ALTER TABLE "ESTIMATESTATE" DROP CONSTRAINT "ESCODE"
/
ALTER TABLE "ESTIMATE" DROP CONSTRAINT "PK_ESTIMATE"
/
ALTER TABLE "WORK" DROP CONSTRAINT "PK_WORK"
/
ALTER TABLE "UNITS" DROP CONSTRAINT "PK_UNITS"
/
ALTER TABLE "UNITS" DROP CONSTRAINT "UNITSNAME"
/
ALTER TABLE "WORKSCATALOG" DROP CONSTRAINT "PK_WORKSCATALOG"
/
ALTER TABLE "WORKSCATALOG" DROP CONSTRAINT "WCCODE"
/
ALTER TABLE "MATERIALSCATALOG" DROP CONSTRAINT "PK_MATERIALSCATALOG"
/
ALTER TABLE "MATERIALSCATALOG" DROP CONSTRAINT "Шифр"
/
ALTER TABLE "MATERIAL" DROP CONSTRAINT "PK_MATERIAL"
/
ALTER TABLE "CLIENT" DROP CONSTRAINT "PK_CLIENT"
/
ALTER TABLE "CLIENT" DROP CONSTRAINT "LOGIN"
/


-- DROP INDEXES SECTION -------------------------------------------------

DROP INDEX "BUILDINGPURPOSEINDEX_O"
/
DROP INDEX "USERIDINDEX_O"
/
DROP INDEX "ESTIMATESTATEINDEX_E"
/
DROP INDEX "OBJECTINDEX_E"
/
DROP INDEX "ESTIMATETYPEINDEX_E"
/
DROP INDEX "CUSTOMERINDEX_E"
/
DROP INDEX "CONTRACTORINDEX_E"
/
DROP INDEX "WORKCATALOGINDEX_W"
/
DROP INDEX "LOCALESTIMATEINDEX_W"
/
DROP INDEX "UNITSINDEX_WC"
/
DROP INDEX "UNITSINDEX_MC"
/
DROP INDEX "MATERIALCATALOGINDEX_M"
/
DROP INDEX "WORKINDEX_M"
/


-- DROP VIEWS SECTION --------------------------------------------------- 

DROP VIEW "ESTIMATEVIEW"
/

-- DROP TABLES SECTION ---------------------------------------------------

DROP TABLE "CONTRACTOR" CASCADE CONSTRAINTS PURGE
/
DROP TABLE "CUSTOMER" CASCADE CONSTRAINTS PURGE
/
DROP TABLE "BUILDINGPURPOSE" CASCADE CONSTRAINTS PURGE
/
DROP TABLE "BUILDOBJECT" CASCADE CONSTRAINTS PURGE
/
DROP TABLE "ESTIMATETYPE" CASCADE CONSTRAINTS PURGE
/
DROP TABLE "ESTIMATESTATE" CASCADE CONSTRAINTS PURGE
/
DROP TABLE "ESTIMATE" CASCADE CONSTRAINTS PURGE
/
DROP TABLE "WORK" CASCADE CONSTRAINTS PURGE
/
DROP TABLE "UNITS" CASCADE CONSTRAINTS PURGE
/
DROP TABLE "WORKSCATALOG" CASCADE CONSTRAINTS PURGE
/
DROP TABLE "MATERIALSCATALOG" CASCADE CONSTRAINTS PURGE
/
DROP TABLE "MATERIAL" CASCADE CONSTRAINTS PURGE
/
DROP TABLE "CLIENT" CASCADE CONSTRAINTS PURGE
/

-- CREATE TABLES SECTION -------------------------------------------------

-- TABLE CLIENT

CREATE TABLE "CLIENT"(
  "USERID" INTEGER NOT NULL,
  "FULLNAME" VARCHAR2(100 ) NOT NULL,
  "PASSWORD" VARCHAR2(100 ) NOT NULL,
  "LOGIN" VARCHAR2(100 ) NOT NULL
)
/

-- ADD KEYS FOR TABLE CLIENT

ALTER TABLE "CLIENT" ADD CONSTRAINT "PK_CLIENT" PRIMARY KEY ("USERID")
/

ALTER TABLE "CLIENT" ADD CONSTRAINT "LOGIN" UNIQUE ("LOGIN")
/

-- TABLE MATERIAL

CREATE TABLE "MATERIAL"(
  "PK_MATERIAL" INTEGER NOT NULL,
  "MATERIALNUMBER" FLOAT NOT NULL,
  "UNITPRICE" INTEGER NOT NULL,
  "PKMATERIALSCATALOG" INTEGER NOT NULL,
  "PKWORK" INTEGER NOT NULL
)
/

-- CREATE INDEXES FOR TABLE MATERIAL

CREATE INDEX "MATERIALCATALOGINDEX_M" ON "MATERIAL" ("PKMATERIALSCATALOG")
/

CREATE INDEX "WORKINDEX_M" ON "MATERIAL" ("PKWORK")
/

-- ADD KEYS FOR TABLE MATERIAL

ALTER TABLE "MATERIAL" ADD CONSTRAINT "PK_MATERIAL" PRIMARY KEY ("PK_MATERIAL")
/

-- TABLE MATERIALSCATALOG

CREATE TABLE "MATERIALSCATALOG"(
  "PK_MATERIALSCATALOG" INTEGER NOT NULL,
  "MATERIALNAME" VARCHAR2(500 ) NOT NULL,
  "CODE" VARCHAR2(100 ) NOT NULL,
  "PKUNITS" INTEGER NOT NULL
)
/

-- CREATE INDEXES FOR TABLE MATERIALSCATALOG

CREATE INDEX "UNITSINDEX_MC" ON "MATERIALSCATALOG" ("PKUNITS")
/

-- ADD KEYS FOR TABLE MATERIALSCATALOG

ALTER TABLE "MATERIALSCATALOG" ADD CONSTRAINT "PK_MATERIALSCATALOG" PRIMARY KEY ("PK_MATERIALSCATALOG")
/

ALTER TABLE "MATERIALSCATALOG" ADD CONSTRAINT "Шифр" UNIQUE ("CODE")
/

-- TABLE WORKSCATALOG

CREATE TABLE "WORKSCATALOG"(
  "PK_WORKCATALOG" INTEGER NOT NULL,
  "WORKNAME" VARCHAR2(500 ) NOT NULL,
  "CODE" VARCHAR2(100 ) NOT NULL,
  "PKUNITS" INTEGER NOT NULL
)
/

-- CREATE INDEXES FOR TABLE WORKSCATALOG

CREATE INDEX "UNITSINDEX_WC" ON "WORKSCATALOG" ("PKUNITS")
/

-- ADD KEYS FOR TABLE WORKSCATALOG

ALTER TABLE "WORKSCATALOG" ADD CONSTRAINT "PK_WORKSCATALOG" PRIMARY KEY ("PK_WORKCATALOG")
/

ALTER TABLE "WORKSCATALOG" ADD CONSTRAINT "WCCODE" UNIQUE ("CODE")
/

-- TABLE UNITS

CREATE TABLE "UNITS"(
  "PK_UNITS" INTEGER NOT NULL,
  "UNITSNAME" VARCHAR2(200 ) NOT NULL,
  "DESIGNATION" VARCHAR2(50 ) NOT NULL
)
/

-- ADD KEYS FOR TABLE UNITS

ALTER TABLE "UNITS" ADD CONSTRAINT "PK_UNITS" PRIMARY KEY ("PK_UNITS")
/

ALTER TABLE "UNITS" ADD CONSTRAINT "UNITSNAME" UNIQUE ("UNITSNAME")
/

-- TABLE WORK

CREATE TABLE "WORK"(
  "PK_WORK" INTEGER NOT NULL,
  "WORKNUMBER" INTEGER NOT NULL,
  "UNITPRICE" INTEGER NOT NULL,
  "PKWORKCATALOG" INTEGER NOT NULL,
  "PKESTIMATE" INTEGER NOT NULL
)
/

-- CREATE INDEXES FOR TABLE WORK

CREATE INDEX "WORKCATALOGINDEX_W" ON "WORK" ("PKWORKCATALOG")
/

CREATE INDEX "LOCALESTIMATEINDEX_W" ON "WORK" ("PKESTIMATE")
/

-- ADD KEYS FOR TABLE WORK

ALTER TABLE "WORK" ADD CONSTRAINT "PK_WORK" PRIMARY KEY ("PK_WORK")
/

-- TABLE ESTIMATE

CREATE TABLE "ESTIMATE"(
  "PK_ESTIMATE" INTEGER NOT NULL,
  "CODE" VARCHAR2(50 ) NOT NULL,
  "CREATIONDATE" DATE,
  "PROJECTCODE" VARCHAR2(50 ),
  "CONTRACTCODE" VARCHAR2(50 ),
  "PKESTIMATESTATE" INTEGER NOT NULL,
  "PKOBJECT" INTEGER NOT NULL,
  "PKESTIMATETYPE" INTEGER NOT NULL,
  "PKCUSTOMER" INTEGER NOT NULL,
  "PKCONTRACTOR" INTEGER NOT NULL
)
/

-- CREATE INDEXES FOR TABLE ESTIMATE

CREATE INDEX "ESTIMATESTATEINDEX_E" ON "ESTIMATE" ("PKESTIMATESTATE")
/

CREATE INDEX "OBJECTINDEX_E" ON "ESTIMATE" ("PKOBJECT")
/

CREATE INDEX "ESTIMATETYPEINDEX_E" ON "ESTIMATE" ("PKESTIMATETYPE")
/

CREATE INDEX "CUSTOMERINDEX_E" ON "ESTIMATE" ("PKCUSTOMER")
/

CREATE INDEX "CONTRACTORINDEX_E" ON "ESTIMATE" ("PKCONTRACTOR")
/

-- ADD KEYS FOR TABLE ESTIMATE

ALTER TABLE "ESTIMATE" ADD CONSTRAINT "PK_ESTIMATE" PRIMARY KEY ("PK_ESTIMATE")
/

-- TABLE ESTIMATESTATE

CREATE TABLE "ESTIMATESTATE"(
  "PK_ESTIMATESTATE" INTEGER NOT NULL,
  "NAME" VARCHAR2(200 ) NOT NULL,
  "CODE" VARCHAR2(50 ) NOT NULL
)
/

-- ADD KEYS FOR TABLE ESTIMATESTATE

ALTER TABLE "ESTIMATESTATE" ADD CONSTRAINT "PK_ESTIMATESTATE" PRIMARY KEY ("PK_ESTIMATESTATE")
/

ALTER TABLE "ESTIMATESTATE" ADD CONSTRAINT "ESCODE" UNIQUE ("CODE")
/

-- TABLE ESTIMATETYPE

CREATE TABLE "ESTIMATETYPE"(
  "PK_ESTIMATETYPE" INTEGER NOT NULL,
  "NAME" VARCHAR2(200 ) NOT NULL,
  "CODE" VARCHAR2(50 ) NOT NULL
)
/

-- ADD KEYS FOR TABLE ESTIMATETYPE

ALTER TABLE "ESTIMATETYPE" ADD CONSTRAINT "PK_ESTIMATETYPE" PRIMARY KEY ("PK_ESTIMATETYPE")
/

ALTER TABLE "ESTIMATETYPE" ADD CONSTRAINT "ETCODE" UNIQUE ("CODE")
/

-- TABLE BUILDOBJECT

CREATE TABLE "BUILDOBJECT"(
  "PK_OBJECT" INTEGER NOT NULL,
  "NAME" VARCHAR2(200 ) NOT NULL,
  "ADDRESS" VARCHAR2(200 ) NOT NULL,
  "PKBUILDINGPURPOSE" INTEGER NOT NULL,
  "USERID" INTEGER NOT NULL
)
/

-- CREATE INDEXES FOR TABLE BUILDOBJECT

CREATE INDEX "BUILDINGPURPOSEINDEX_O" ON "BUILDOBJECT" ("PKBUILDINGPURPOSE")
/

CREATE INDEX "USERIDINDEX_O" ON "BUILDOBJECT" ("USERID")
/

-- ADD KEYS FOR TABLE BUILDOBJECT

ALTER TABLE "BUILDOBJECT" ADD CONSTRAINT "PK_OBJECT" PRIMARY KEY ("PK_OBJECT")
/

-- TABLE BUILDINGPURPOSE

CREATE TABLE "BUILDINGPURPOSE"(
  "PK_BUILDINGPURPOSE" INTEGER NOT NULL,
  "NAME" VARCHAR2(200 ) NOT NULL,
  "CODE" VARCHAR2(50 ) NOT NULL
)
/

-- ADD KEYS FOR TABLE BUILDINGPURPOSE

ALTER TABLE "BUILDINGPURPOSE" ADD CONSTRAINT "PK_BUILDINGPURPOSE" PRIMARY KEY ("PK_BUILDINGPURPOSE")
/

ALTER TABLE "BUILDINGPURPOSE" ADD CONSTRAINT "BPCODE" UNIQUE ("CODE")
/

-- TABLE CUSTOMER

CREATE TABLE "CUSTOMER"(
  "PK_CUSTOMER" INTEGER NOT NULL,
  "CUSTFULLNAME" VARCHAR2(200 ) NOT NULL,
  "CUSTBUSINESSNAME" VARCHAR2(200 ) NOT NULL
)
/

-- ADD KEYS FOR TABLE CUSTOMER

ALTER TABLE "CUSTOMER" ADD CONSTRAINT "PK_CUSTOMER" PRIMARY KEY ("PK_CUSTOMER")
/

ALTER TABLE "CUSTOMER" ADD CONSTRAINT "CUSTOMERBN" UNIQUE ("CUSTBUSINESSNAME")
/

-- TABLE CONTRACTOR

CREATE TABLE "CONTRACTOR"(
  "PK_CONTRACTOR" INTEGER NOT NULL,
  "CONTRFULLNAME" VARCHAR2(200 ) NOT NULL,
  "CONTRBUSINESSNAME" VARCHAR2(200 ) NOT NULL
)
/

-- ADD KEYS FOR TABLE CONTRACTOR

ALTER TABLE "CONTRACTOR" ADD CONSTRAINT "PK_CONTRACTOR" PRIMARY KEY ("PK_CONTRACTOR")
/

ALTER TABLE "CONTRACTOR" ADD CONSTRAINT "CONTRACTORBN" UNIQUE ("CONTRBUSINESSNAME")
/

-- CREATE VIEWS SECTION -------------------------------------------------

CREATE VIEW "ESTIMATEVIEW" AS
SELECT "PK_ESTIMATE", "CODE", "CREATIONDATE", "PROJECTCODE", "CONTRACTCODE", "CUSTFULLNAME", "CUSTBUSINESSNAME", "CONTRFULLNAME", "CONTRBUSINESSNAME"
FROM "ESTIMATE", "CUSTOMER", "CONTRACTOR"
/

-- CREATE RELATIONSHIPS SECTION ------------------------------------------------- 

ALTER TABLE "MATERIALSCATALOG" ADD CONSTRAINT "UNITS_MATERIALSCATALOG" FOREIGN KEY ("PKUNITS") REFERENCES "UNITS" ("PK_UNITS")
/

ALTER TABLE "MATERIAL" ADD CONSTRAINT "MATERIALSCATALOG_MATERIAL" FOREIGN KEY ("PKMATERIALSCATALOG") REFERENCES "MATERIALSCATALOG" ("PK_MATERIALSCATALOG")
/

ALTER TABLE "ESTIMATE" ADD CONSTRAINT "ESTIMATESTATE_ESTIMATE" FOREIGN KEY ("PKESTIMATESTATE") REFERENCES "ESTIMATESTATE" ("PK_ESTIMATESTATE")
/

ALTER TABLE "ESTIMATE" ADD CONSTRAINT "OBJECT_ESTIMATE" FOREIGN KEY ("PKOBJECT") REFERENCES "BUILDOBJECT" ("PK_OBJECT") ON DELETE CASCADE
/

ALTER TABLE "MATERIAL" ADD CONSTRAINT "WORK_MATERIAL" FOREIGN KEY ("PKWORK") REFERENCES "WORK" ("PK_WORK") ON DELETE CASCADE
/

ALTER TABLE "WORKSCATALOG" ADD CONSTRAINT "UNITS_WORKSCATALOG" FOREIGN KEY ("PKUNITS") REFERENCES "UNITS" ("PK_UNITS")
/

ALTER TABLE "WORK" ADD CONSTRAINT "WORKSCATALOG_WORK" FOREIGN KEY ("PKWORKCATALOG") REFERENCES "WORKSCATALOG" ("PK_WORKCATALOG")
/

ALTER TABLE "WORK" ADD CONSTRAINT "ESTIMATE_WORK" FOREIGN KEY ("PKESTIMATE") REFERENCES "ESTIMATE" ("PK_ESTIMATE") ON DELETE CASCADE
/

ALTER TABLE "ESTIMATE" ADD CONSTRAINT "ESTIMATETYPE_ESTIMATE" FOREIGN KEY ("PKESTIMATETYPE") REFERENCES "ESTIMATETYPE" ("PK_ESTIMATETYPE")
/

ALTER TABLE "BUILDOBJECT" ADD CONSTRAINT "BUILDINGPURPOSE_OBJECT" FOREIGN KEY ("PKBUILDINGPURPOSE") REFERENCES "BUILDINGPURPOSE" ("PK_BUILDINGPURPOSE")
/

ALTER TABLE "ESTIMATE" ADD CONSTRAINT "CUSTOMER_ESTIMATE" FOREIGN KEY ("PKCUSTOMER") REFERENCES "CUSTOMER" ("PK_CUSTOMER")
/

ALTER TABLE "BUILDOBJECT" ADD CONSTRAINT "CLIENT_OBJECT" FOREIGN KEY ("USERID") REFERENCES "CLIENT" ("USERID")
/

ALTER TABLE "ESTIMATE" ADD CONSTRAINT "CONTRACTOR_ESTIMATE" FOREIGN KEY ("PKCONTRACTOR") REFERENCES "CONTRACTOR" ("PK_CONTRACTOR")
/





